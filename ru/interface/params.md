## Перебор параметров

- [Зачем перебирать параметры](#intro)
- [Передача параметров в стратегию](#to_strategy)
- [Чтение параметров из стратегии](#from_strategy)

#### Зачем перебирать параметры {#intro}

Зачастую в торговых стратегиях возникает необходимость подобрать какой-либо числовой параметр на основе исторических данных.
Для этого оказывается полезным интерфейс перебора параметров.

#### Передача параметров в стратегию {#to_strategy}

На странице с отправкой стратегии имеется возможность передавать стратегии набор числовых атомарных параметров для перебора.
Для этого нужно открыть вкладку *Параметры запуска*, далее в поле *Parameter* ввести имя параметра, а в соседнее поле ввести значения параметра.
Все значения могут быть целыми или вещественными с точкой в качестве разделителя.

Рассмотрим способы задания параметров:

1. Постоянная:

  <img src="{{ book["gitbook.img"] }}/param_const_double_set.png" title="Константный вещественный параметр">
2. Список значений через запятую:

  <img src="{{ book["gitbook.img"] }}/param_list_int_set.png" title="Список целых значений">
3. Диапазон значений с шагом: (start, end, step):

  <img src="{{ book["gitbook.img"] }}/param_range_int_set.png" title="Диапазон значений от 0 до 10 с шагом 2">

После ввода поля значений параметра нужно добавить эти значения, нажав на кнопку *Add*.
В таком случае параметры, заданные способами 1 и 2 передадутся как есть, а параметры, заданные диапазоном значений с шагом раскроются в список параметров автоматически и отобразятся в таблице параметров.
После добавления параметров для перебора под таблицей параметров отобразится поле *Total combinations*, означающее общее число комбинаций параметров, то есть декартово произведение всех наборов параметров.

В результате получим:

1. Добавили постоянную double_param = 3.14.
  Всего комбинаций – 1.

  <img src="{{ book["gitbook.img"] }}/param_const_double_res.png" title="Добавили постоянную double_param = 3.14">
2. Добавили список целых значений от 1 до 4.
  Всего комбинаций – 4.

  <img src="{{ book["gitbook.img"] }}/param_list_int_res.png" title="Добавили список целых значений от 1 до 4">
3. Добавили диапазон значений от 0 до 10 с шагом 2.
  Всего комбинаций – 6.

  <img src="{{ book["gitbook.img"] }}/param_range_int_res.png" title="Добавили диапазон значений от 0 до 10 с шагом 2">

Интерфейс перебора параметров позволяет добавлять несколько различных параметров, а также отключать перебор, задавая значение по умолчанию (*default value*):

- Пример задания нескольких серий параметров.
  2 значения для *double_param* и 4 значения для *int_param* дают 4 * 2 = 8 комбинаций.

  <img src="{{ book["gitbook.img"] }}/param_double_int_combo.png" title="Пример задания нескольких серий параметров">
- Пример отключения перебора параметра double_param, значение по умолчанию = 0:

  <img src="{{ book["gitbook.img"] }}/param_double_int_turn_off_double.png" title="Пример отключения перебора параметра double_param">

#### Чтение параметров из стратегии {#from_strategy}

Все переданные стратегии параметры можно извлечь из файла конфигурации, передаваемого в конструктор стратегии пользователя *UserStrategy*.
Параметры файла конфигурации приводятся к нужному типу с помощью метода `as<param_type>(deafult_value)`.
При этом если вы не выберете значения для параметра, для него будет использовано значение по умолчанию `deafult_value`.

```c++
class UserStrategy : public ParticipantStrategy {
public:
  // Параметры стратегии, которые хочется подобрать.
  int int_param;
  double double_param;
  Microseconds time_param;

  UserStrategy(const JsonValue& config) {
    // Читаем целочисленный параметр.
    int_param = config["int_param"].as<int>(42);
    // Читаем вещественный параметр.
    double_param = config["double_param"].as<double>(3.14);
    // Читаем временной параметр.
    // ! Временной параметр по умолчанию необходимо указывать с единицей измерения (литералом).
    // Возможные литералы:
    // h - часы,
    // min - минуты,
    // s - секунда,
    // ms - миллисекунды,
    // us - микросекунды.
    time_param = config["time_param"].as<Microseconds>(3s);
  }

}
```
